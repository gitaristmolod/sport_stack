<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sport Stack</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            touch-action: none;
        }

        #mainMenu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        #mainMenu h1 {
            font-size: 48px;
            color: white;
            margin-bottom: 10px;
            text-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        #mainMenu p {
            color: rgba(255,255,255,0.9);
            font-size: 16px;
            margin-bottom: 40px;
            text-align: center;
        }

        .menu-btn {
            width: 280px;
            padding: 18px;
            margin: 8px;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .menu-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .menu-btn.primary {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: none;
            flex-direction: column;
        }

        #gameContainer.active {
            display: flex;
        }

        #topBar {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-weight: bold;
            backdrop-filter: blur(10px);
        }

        #menuButton {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
        }

        #score {
            font-size: 24px;
        }

        #nextBall {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        #canvas {
            flex: 1;
            display: block;
            background: linear-gradient(to bottom, #2c3e50 0%, #34495e 100%);
        }

        #gameOver, #pauseMenu, #ratingScreen, #settingsScreen, #helpScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            display: none;
            z-index: 1000;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        #gameOver h1, #pauseMenu h1, #ratingScreen h1, #settingsScreen h1, #helpScreen h1 {
            font-size: 36px;
            margin-bottom: 20px;
        }

        #gameOver h1 {
            color: #e74c3c;
        }

        #gameOver p, #pauseMenu p {
            font-size: 20px;
            margin-bottom: 30px;
        }

        .game-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
            margin: 5px;
        }

        .game-btn:active {
            transform: scale(0.95);
        }

        .game-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
        }

        .emoji {
            font-size: 32px;
        }

        #ratingList {
            text-align: left;
            margin: 20px 0;
            font-size: 16px;
        }

        .rating-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .settings-option, .help-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            text-align: left;
        }

        .help-section h3 {
            margin-bottom: 10px;
            color: #667eea;
        }
    </style>
</head>
<body>
    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div id="mainMenu">
        <h1>üèÜ SPORT STACK</h1>
        <p>–°—Ç–µ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –º—è—á–µ–π</p>
        <button class="menu-btn primary" onclick="startGame()">üéÆ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
        <button class="menu-btn" onclick="showRating()">üèÜ –†–ï–ô–¢–ò–ù–ì</button>
        <button class="menu-btn" onclick="showSettings()">‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</button>
        <button class="menu-btn" onclick="showHelp()">‚ÑπÔ∏è –ü–û–ú–û–©–¨</button>
        <button class="menu-btn" onclick="exitGame()">‚ùå –í–´–•–û–î</button>
    </div>

    <!-- –ò–ì–†–ê -->
    <div id="gameContainer">
        <div id="topBar">
            <button id="menuButton" onclick="pauseGame()">‚ò∞ –ú–ï–ù–Æ</button>
            <div id="score">–°–ß–Å–¢: <span id="scoreValue">0</span></div>
            <div id="nextBall">
                <span>–î–ê–õ–¨–®–ï:</span>
                <span class="emoji" id="nextBallEmoji">üèì</span>
            </div>
        </div>
        <canvas id="canvas"></canvas>
        
        <!-- GAME OVER -->
        <div id="gameOver">
            <h1>GAME OVER!</h1>
            <p>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç: <span id="finalScore">0</span></p>
            <button class="game-btn" onclick="restartGame()">üîÑ –ï–©–Å –†–ê–ó</button>
            <button class="game-btn secondary" onclick="backToMenu()">üè† –í –ú–ï–ù–Æ</button>
        </div>

        <!-- –ü–ê–£–ó–ê -->
        <div id="pauseMenu">
            <h1>–ü–ê–£–ó–ê</h1>
            <p>–ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p>
            <button class="game-btn" onclick="resumeGame()">‚ñ∂Ô∏è –ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
            <button class="game-btn secondary" onclick="restartGame()">üîÑ –ó–ê–ù–û–í–û</button>
            <button class="game-btn secondary" onclick="backToMenu()">üè† –í –ú–ï–ù–Æ</button>
        </div>
    </div>

    <!-- –†–ï–ô–¢–ò–ù–ì -->
    <div id="ratingScreen">
        <h1>üèÜ –†–ï–ô–¢–ò–ù–ì</h1>
        <div id="ratingList">
            <div class="rating-item">ü•á 1. –ò–≥—Ä–æ–∫ 1: 1250 –æ—á–∫–æ–≤</div>
            <div class="rating-item">ü•à 2. –ò–≥—Ä–æ–∫ 2: 980 –æ—á–∫–æ–≤</div>
            <div class="rating-item">ü•â 3. –ò–≥—Ä–æ–∫ 3: 750 –æ—á–∫–æ–≤</div>
            <div class="rating-item">4. –í—ã: 0 –æ—á–∫–æ–≤</div>
        </div>
        <button class="game-btn" onclick="hideRating()">‚óÄÔ∏è –ù–ê–ó–ê–î</button>
    </div>

    <!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
    <div id="settingsScreen">
        <h1>‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò</h1>
        <div class="settings-option">
            <strong>üîä –ó–≤—É–∫:</strong> –í–∫–ª—é—á–µ–Ω ‚úÖ
        </div>
        <div class="settings-option">
            <strong>üì≥ –í–∏–±—Ä–∞—Ü–∏—è:</strong> –í–∫–ª—é—á–µ–Ω–∞ ‚úÖ
        </div>
        <div class="settings-option">
            <strong>üé® –¢–µ–º–∞:</strong> –¢—ë–º–Ω–∞—è üåô
        </div>
        <button class="game-btn" onclick="hideSettings()">‚óÄÔ∏è –ù–ê–ó–ê–î</button>
    </div>

    <!-- –ü–û–ú–û–©–¨ -->
    <div id="helpScreen">
        <h1>‚ÑπÔ∏è –ü–û–ú–û–©–¨</h1>
        <div class="help-section">
            <h3>üéØ –ö–ê–ö –ò–ì–†–ê–¢–¨:</h3>
            <p>‚Ä¢ –¢–∞–ø–∞–π—Ç–µ –ø–æ —ç–∫—Ä–∞–Ω—É —á—Ç–æ–±—ã –±—Ä–æ—Å–∏—Ç—å –º—è—á<br>
            ‚Ä¢ –î–≤–∏–≥–∞–π—Ç–µ –ø–∞–ª—å—Ü–µ–º –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–æ–∑–∏—Ü–∏–∏<br>
            ‚Ä¢ –°–æ–µ–¥–∏–Ω—è–π—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –º—è—á–∏<br>
            ‚Ä¢ –ù–µ –¥–∞–π—Ç–µ –≤—ã–π—Ç–∏ –∑–∞ –∫—Ä–∞—Å–Ω—É—é –ª–∏–Ω–∏—é!</p>
        </div>
        <div class="help-section">
            <h3>üèì –¶–ï–ü–û–ß–ö–ê –ú–Ø–ß–ï–ô:</h3>
            <p>üèì –ü–∏–Ω–≥-–ø–æ–Ω–≥ (15) ‚Üí üéæ –¢–µ–Ω–Ω–∏—Å (30)<br>
            ‚öæ –ë–µ–π—Å–±–æ–ª (50) ‚Üí üèê –í–æ–ª–µ–π–±–æ–ª (80)<br>
            ‚öΩ –§—É—Ç–±–æ–ª (120) ‚Üí üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª (170)<br>
            üé≥ –ë–æ—É–ª–∏–Ω–≥ (230) ‚Üí ‚öñÔ∏è –ú–µ–¥–±–æ–ª (300)<br>
            üí™ –§–∏—Ç–±–æ–ª (400) - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π!</p>
        </div>
        <button class="game-btn" onclick="hideHelp()">‚óÄÔ∏è –ù–ê–ó–ê–î</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.disableVerticalSwipes();

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('scoreValue');
        const nextBallEmoji = document.getElementById('nextBallEmoji');
        const gameContainer = document.getElementById('gameContainer');
        const mainMenu = document.getElementById('mainMenu');
        const gameOverDiv = document.getElementById('gameOver');
        const pauseMenuDiv = document.getElementById('pauseMenu');
        const finalScoreElement = document.getElementById('finalScore');

        let game = null;
        let isPaused = false;

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight - 60;

        const BALL_TYPES = {
            'ping_pong': { 
                radius: 15, color: '#FFFFFF', emoji: 'üèì', next: 'tennis', points: 15,
                mass: 0.3, bounce: 0.9, friction: 0.98
            },
            'tennis': { 
                radius: 20, color: '#ADFF2F', emoji: 'üéæ', next: 'baseball', points: 30,
                mass: 0.8, bounce: 0.85, friction: 0.97
            },
            'baseball': { 
                radius: 25, color: '#FFFFFF', emoji: '‚öæ', next: 'volleyball', points: 50,
                mass: 2.0, bounce: 0.6, friction: 0.95
            },
            'volleyball': { 
                radius: 35, color: '#FFFFFF', emoji: 'üèê', next: 'football', points: 80,
                mass: 3.5, bounce: 0.8, friction: 0.96
            },
            'football': { 
                radius: 40, color: '#FFFFFF', emoji: '‚öΩ', next: 'basketball', points: 120,
                mass: 5.0, bounce: 0.75, friction: 0.94
            },
            'basketball': { 
                radius: 50, color: '#FF8C00', emoji: 'üèÄ', next: 'bowling', points: 170,
                mass: 7.0, bounce: 0.82, friction: 0.95
            },
            'bowling': { 
                radius: 60, color: '#000000', emoji: 'üé≥', next: 'medicine', points: 230,
                mass: 80.0, bounce: 0.2, friction: 0.85
            },
            'medicine': { 
                radius: 75, color: '#8B4513', emoji: '‚öñÔ∏è', next: 'exercise', points: 300,
                mass: 120.0, bounce: 0.3, friction: 0.88
            },
            'exercise': { 
                radius: 95, color: '#4682B4', emoji: 'üí™', next: null, points: 400,
                mass: 150.0, bounce: 0.5, friction: 0.90
            }
        };

        class Ball {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.radius = BALL_TYPES[type].radius;
                this.color = BALL_TYPES[type].color;
                this.mass = BALL_TYPES[type].mass;
                this.bounce = BALL_TYPES[type].bounce;
                this.friction = BALL_TYPES[type].friction;
                this.vx = 0;
                this.vy = 0;
                this.merged = false;
                this.age = 0;
            }

            draw() {
                ctx.save();
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 5;

                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 3;
                ctx.stroke();

                ctx.shadowColor = 'transparent';
                ctx.beginPath();
                ctx.arc(this.x - this.radius/3, this.y - this.radius/3, this.radius/4, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.fill();

                ctx.restore();
            }
        }

        class Game {
            constructor() {
                this.balls = [];
                this.score = 0;
                this.gameOver = false;
                this.nextBallType = this.randomBallType();
                this.dropX = canvas.width / 2;
                this.containerY = 100;
                this.containerLeft = 40;
                this.containerRight = canvas.width - 40;
                this.containerBottom = canvas.height - 30;
                this.isDropping = false;
            }

            randomBallType() {
                const types = ['ping_pong', 'tennis', 'baseball', 'volleyball'];
                return types[Math.floor(Math.random() * types.length)];
            }

            dropBall() {
                if (this.gameOver || this.isDropping || isPaused) return;
                this.isDropping = true;
                const ball = new Ball(this.dropX, this.containerY - 30, this.nextBallType);
                this.balls.push(ball);
                this.nextBallType = this.randomBallType();
                nextBallEmoji.textContent = BALL_TYPES[this.nextBallType].emoji;
                
                setTimeout(() => {
                    this.isDropping = false;
                }, 500);
            }

            updatePhysics() {
                if (isPaused) return;
                
                const gravity = 0.35;

                for (let ball of this.balls) {
                    if (ball.merged) continue;

                    ball.age++;
                    ball.vy += gravity * (1 + ball.mass * 0.01);
                    ball.x += ball.vx;
                    ball.y += ball.vy;

                    if (ball.x - ball.radius < this.containerLeft) {
                        ball.x = this.containerLeft + ball.radius;
                        ball.vx *= -ball.bounce;
                    }
                    if (ball.x + ball.radius > this.containerRight) {
                        ball.x = this.containerRight - ball.radius;
                        ball.vx *= -ball.bounce;
                    }
                    if (ball.y + ball.radius > this.containerBottom) {
                        ball.y = this.containerBottom - ball.radius;
                        ball.vy *= -ball.bounce;
                        ball.vx *= ball.friction;
                        
                        if (Math.abs(ball.vy) < 0.5) ball.vy = 0;
                        if (Math.abs(ball.vx) < 0.3) ball.vx = 0;
                    }

                    if (Math.abs(ball.vx) < 1.5) ball.vx *= 0.98;
                    if (Math.abs(ball.vy) < 1.5) ball.vy *= 0.98;

                    if (ball.y - ball.radius < this.containerY && ball.age > 60 && Math.abs(ball.vy) < 1) {
                        this.endGame();
                    }
                }

                this.checkCollisions();
            }

            checkCollisions() {
                const mergedPairs = [];

                for (let i = 0; i < this.balls.length; i++) {
                    const b1 = this.balls[i];
                    if (b1.merged) continue;

                    for (let j = i + 1; j < this.balls.length; j++) {
                        const b2 = this.balls[j];
                        if (b2.merged) continue;

                        const dx = b2.x - b1.x;
                        const dy = b2.y - b1.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        const minDist = b1.radius + b2.radius;

                        if (dist < minDist && dist > 0) {
                            const nx = dx / dist;
                            const ny = dy / dist;
                            
                            const overlap = minDist - dist;
                            const totalMass = b1.mass + b2.mass;
                            const ratio1 = b2.mass / totalMass;
                            const ratio2 = b1.mass / totalMass;
                            
                            b1.x -= nx * overlap * ratio1;
                            b1.y -= ny * overlap * ratio1;
                            b2.x += nx * overlap * ratio2;
                            b2.y += ny * overlap * ratio2;

                            const dvx = b2.vx - b1.vx;
                            const dvy = b2.vy - b1.vy;
                            const dvn = dvx * nx + dvy * ny;

                            if (dvn < 0) {
                                const restitution = Math.min(b1.bounce, b2.bounce);
                                const impulse = (-(1 + restitution) * dvn) / (1/b1.mass + 1/b2.mass);
                                
                                const impulseX = (impulse / b1.mass) * nx;
                                const impulseY = (impulse / b1.mass) * ny;
                                
                                b1.vx -= impulseX;
                                b1.vy -= impulseY;
                                b2.vx += (impulse / b2.mass) * nx;
                                b2.vy += (impulse / b2.mass) * ny;
                                
                                if (Math.abs(impulseX) < 0.1) {
                                    b1.vx *= 0.5;
                                    b2.vx *= 0.5;
                                }
                                if (Math.abs(impulseY) < 0.1) {
                                    b1.vy *= 0.5;
                                    b2.vy *= 0.5;
                                }
                            } else {
                                if (Math.abs(b1.vx) < 0.5 && Math.abs(b1.vy) < 0.5) {
                                    b1.vx *= 0.8;
                                    b1.vy *= 0.8;
                                }
                                if (Math.abs(b2.vx) < 0.5 && Math.abs(b2.vy) < 0.5) {
                                    b2.vx *= 0.8;
                                    b2.vy *= 0.8;
                                }
                            }

                            if (b1.type === b2.type && b1.age > 30 && b2.age > 30) {
                                mergedPairs.push([i, j]);
                            }
                        }
                    }
                }

                for (let [i, j] of mergedPairs) {
                    const b1 = this.balls[i];
                    const b2 = this.balls[j];
                    const nextType = BALL_TYPES[b1.type].next;

                    if (nextType) {
                        const totalMass = b1.mass + b2.mass;
                        const newBall = new Ball(
                            (b1.x * b1.mass + b2.x * b2.mass) / totalMass,
                            (b1.y * b1.mass + b2.y * b2.mass) / totalMass,
                            nextType
                        );
                        
                        newBall.vx = (b1.vx * b1.mass + b2.vx * b2.mass) / totalMass * 0.5;
                        newBall.vy = (b1.vy * b1.mass + b2.vy * b2.mass) / totalMass * 0.5;
                        
                        this.balls.push(newBall);
                        this.score += BALL_TYPES[nextType].points;
                        scoreElement.textContent = this.score;
                        
                        if (tg.HapticFeedback) {
                            tg.HapticFeedback.impactOccurred('medium');
                        }
                    }

                    b1.merged = true;
                    b2.merged = true;
                }

                this.balls = this.balls.filter(b => !b.merged);
            }

            render() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                ctx.fillStyle = 'rgba(236, 240, 241, 0.2)';
                ctx.fillRect(this.containerLeft - 10, this.containerY, 10, this.containerBottom - this.containerY);
                ctx.fillRect(this.containerRight, this.containerY, 10, this.containerBottom - this.containerY);
                ctx.fillRect(this.containerLeft - 10, this.containerBottom, this.containerRight - this.containerLeft + 20, 10);

                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 3;
                ctx.setLineDash([10, 5]);
                ctx.beginPath();
                ctx.moveTo(this.containerLeft, this.containerY);
                ctx.lineTo(this.containerRight, this.containerY);
                ctx.stroke();
                ctx.setLineDash([]);

                for (let ball of this.balls) {
                    ball.draw();
                }

                const nextRadius = BALL_TYPES[this.nextBallType].radius;
                const nextColor = BALL_TYPES[this.nextBallType].color;

                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(this.dropX, 60);
                ctx.lineTo(this.dropX, this.containerY);
                ctx.stroke();
                ctx.setLineDash([]);

                ctx.beginPath();
                ctx.arc(this.dropX, this.containerY - 30, nextRadius, 0, Math.PI * 2);
                ctx.strokeStyle = nextColor;
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            endGame() {
                if (this.gameOver) return;
                this.gameOver = true;
                finalScoreElement.textContent = this.score;
                gameOverDiv.style.display = 'block';
                
                if (tg.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
            }
        }

        function startGame() {
            mainMenu.style.display = 'none';
            gameContainer.classList.add('active');
            game = new Game();
            isPaused = false;
            gameLoop();
        }

        function pauseGame() {
            isPaused = true;
            pauseMenuDiv.style.display = 'block';
        }

        function resumeGame() {
            isPaused = false;
            pauseMenuDiv.style.display = 'none';
        }

        function restartGame() {
            gameOverDiv.style.display = 'none';
            pauseMenuDiv.style.display = 'none';
            game = new Game();
            isPaused = false;
            scoreElement.textContent = '0';
        }

        function backToMenu() {
            gameContainer.classList.remove('active');
            mainMenu.style.display = 'flex';
            gameOverDiv.style.display = 'none';
            pauseMenuDiv.style.display = 'none';
            game = null;
        }

        function showRating() {
            mainMenu.style.display = 'none';
            document.getElementById('ratingScreen').style.display = 'block';
        }

        function hideRating() {
            document.getElementById('ratingScreen').style.display = 'none';
            mainMenu.style.display = 'flex';
        }

        function showSettings() {
            mainMenu.style.display = 'none';
            document.getElementById('settingsScreen').style.display = 'block';
        }

        function hideSettings() {
            document.getElementById('settingsScreen').style.display = 'none';
            mainMenu.style.display = 'flex';
        }

        function showHelp() {
            mainMenu.style.display = 'none';
            document.getElementById('helpScreen').style.display = 'block';
        }

        function hideHelp() {
            document.getElementById('helpScreen').style.display = 'none';
            mainMenu.style.display = 'flex';
        }

        function exitGame() {
            tg.close();
        }

        canvas.addEventListener('touchstart', (e) => {
            if (!game || isPaused) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            game.dropX = touch.clientX - rect.left;
            game.dropX = Math.max(game.containerLeft + 30, Math.min(game.containerRight - 30, game.dropX));
        });

        canvas.addEventListener('touchmove', (e) => {
            if (!game || isPaused) return;
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            game.dropX = touch.clientX - rect.left;
            game.dropX = Math.max(game.containerLeft + 30, Math.min(game.containerRight - 30, game.dropX));
        });

        canvas.addEventListener('touchend', (e) => {
            if (!game || isPaused) return;
            e.preventDefault();
            game.dropBall();
        });

        canvas.addEventListener('click', (e) => {
            if (!game || isPaused) return;
            const rect = canvas.getBoundingClientRect();
            game.dropX = e.clientX - rect.left;
            game.dropX = Math.max(game.containerLeft + 30, Math.min(game.containerRight - 30, game.dropX));
            game.dropBall();
        });

        function gameLoop() {
            if (game && !game.gameOver) {
                game.updatePhysics();
            }
            if (game) {
                game.render();
            }
            requestAnimationFrame(gameLoop);
        }

        tg.ready();
    </script>
</body>
</html>
